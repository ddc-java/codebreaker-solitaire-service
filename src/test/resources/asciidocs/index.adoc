= Codebreaker Solitaire API Guide
Nicholas Bennett <nick@nickbenn.com>
v{projectVersion}
:doctype: book
:favicon: img/deep-dive-all-cohorts.png
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 4
:sectlinks:

[[codebreaker_overview]]
== What is _Codebreaker_?

_Codebreaker_ is a simple game of deductive reasoning---a more generalized variant of the board game _Mastermind_ and the earlier pencil-and-paper game _Bulls and Cows_---implemented as a RESTful service that permits clients (consumers of the service) to present the game to users for play.

[[play_overview]]
== Rules of play

These are the rules of play for a generalized form of _Bulls and Cows_, stated in a form suitable for playing with pencil and paper.

=== Players

There are 2 roles in the game: _codemaker_ and _codebreaker_. In the pencil-and-paper and board game variants, players typically alternate playing these roles.

=== Sequence of play

==== _Codemaker_: Create the code

A game begins when the codebreaker requests that a new code be created, with specified (ore previously agreed on) length and pool of characters. The codemaker generates the code accordingly, and keeps it secret.

==== _Codebreaker_: Crack the code

The objective of the codebreaker in the game is to learn the secret code created by the codemaker, using as few guesses as possible.

===== _Codebreaker_: Make a guess

Each guess consists of a string of characters, with length equal to that of the code, and made up only of characters found in the pool used when creating the code.

===== _Codebreaker_: Evaluate the guess

When a guess is submitted, the response from the codemaker consists of 2 numbers:

* *Exact matches*
+
The number of characters in the code that are matched _exactly_ by the characters in the corresponding positions of the guess.

* *Near matches*
+
The number of characters in the code that aren't matched _exactly_ by the corresponding characters in the guess, but are matched by characters in the guess in non-corresponding positions.

Any character, in either the code or the guess, can only be used once when counting matches. That is, a corresponding pair of characters in the code and guess that form an exact match can't be used in any near matches, and any character used in one near match can't be used in any others.

===== _Codebreaker_: Refine the guess

Using the codemaker's response to the most recent guess, along with responses to any previous guesses (if any), the codebreaker refines the guess---after which the codemaker evaluates the new guess and tells the codebreaker the counts of exact and near matches, the codebreaker refines the guess, and so on.

==== End of play

A single game ends when the codebreaker successfully guesses the code.

Typically players will play multiple games, alternating roles, and keeping a tally of the total number of guesses for each player. After an agreed-on (even) number of games, the player with the lowest guess tally wins.

==== Guess example

Assume that the secret code is "BACD", and the codebreaker guesses "AABB".

* *Exact matches*
+
The "A" in the second position of the code is matched exactly by the corresponding "A" in the guess. No other character in the guess matches the character in the corresponding position of the code. Therefore, the number of exact matches is 1.

* *Near matches*
+
The "A" in the second position of the guess was already counted as an exact match, so neither it nor its corresponding "A" in the code can be considered in this count. As a result, the "A" in the first position of the guess _doesn't_ form a near match with an "A" in the code.

The "B" in the third position of the guess _does_ form a near match with the "B" in the first position of the code. However, this means the the sole "B" in the code may noy be used in any further near matches, so the "B" in the fourth position of the guess _doesn't_ have a near match.

Note that if we scanned from from right to left to look for matches, the "B" in the fourth position of the guess would have a near match with the "B" in the first position of the code, but the "B" in the third position of the guess would not have any near match. Either way, the count would be the same: 1 near match.

== Service

=== Overview

The Codebreaker Solitaire service acts as the codemaker, with endpoints allowing a client (in the codebreaker role) to start, retrieve, and delete games, and to submit and retrieve guesses.

Since the service is _always_ the codemaker, and since the service provides no capabilities to compare a given codebreaker's performance against that of any other codebreaker using the service, this is best suited to solitaire gameplay: A client application would make requests of the service to start games and submit guesses on behalf of a user; an indefinite number of games could be played in this fashion, presumably with the aim of improving the user's deductive reasoning skills.

=== Basic specifications

* The service does not require authentication or an API key.

* All requests that include body content are expected to send that content as JSON, accompanied by the `Content-type: application/json` header.

* If the request includes an `Accept` header, it must include `application/json` in the list of acceptable content types.

* All non-empty response bodies returned by the service are also JSON, also with the `Content-type: application/json` header.

* Every 24 hours, inactive games are removed from the database. An inactive game is defined as one which has had no guesses submitted in the last 14 days.

=== Endpoints

[[post_game_endpoint]]
==== Start new game

===== Request

`POST /codebreaker/games`

Starts a new game, randomly generating a secret code using the properties specified in the request body.

====== Body

|===
|Type|Description

|<<game_post_schema,`Game`>>
|Code generation settings.

|===

===== Responses

|===
|Status|Body|Description

|201 Created
|<<game_get_schema,`Game`>>
|Code generated & game started successfully.
|400 Bad Request
|<<error_schema,`Error`>>
|Invalid code length or character pool.

|===

===== Example

====== Request

include::{snippets}/games/post-valid/http-request.adoc[]

====== Response

include::{snippets}/games/post-valid/http-response.adoc[]

==== Retrieve a game

===== Request

`GET /codebreaker/games/{gameId}`

Returns the game with the unique identifier `gameId`.

===== Path parameters

include::{snippets}/games/get-valid/path-parameters.adoc[]

===== Responses

|===
|Status|Body|Description

|200 OK
|<<game_get_schema,`Game`>>
|Specified game returned.
|404 Not Found
|<<error_schema,`Error`>>
|No game exists with an `id` equal to the specified `gameId`.

|===

===== Example

====== Request

include::{snippets}/games/get-valid/http-request.adoc[]

====== Response

include::{snippets}/games/get-valid/http-response.adoc[]

[[post_guess_endpoint]]
==== Submit a guess

===== Request

`POST /codebreaker/games/{gameId}/guesses`

Submits a guess against the game specified by `gameId`.

====== Path parameters

include::{snippets}/guesses/post-valid/path-parameters.adoc[]

====== Body

|===
|Type|Description

|<<guess_post_schema,`Guess`>>
|Text of guess.

|===

===== Responses

|===
|Status|Body|Description

|201 OK
|<<guess_get_schema,`Guess`>>
|Guess submitted successfully.
|400 Bad Request
|<<error_schema,`Error`>>
|Length of guess doesn't match code length.
|404 Not Found
|<<error_schema,`Error`>>
|No game exists with an `id` equal to the specified `gameId`.

|===

===== Example

====== Request

include::{snippets}/guesses/post-valid/http-request.adoc[]

====== Response

include::{snippets}/guesses/post-valid/http-response.adoc[]

==== Retrieve a guess

===== Request

`GET /codebreaker/games/{gameId}/guesses/{guessId}`

Returns the guess with the unique identifier `guessId` submitted in the game identified by `gameId`.

====== Path parameters

include::{snippets}/guesses/get-valid/path-parameters.adoc[]

===== Responses

|===
|Status|Body|Description

|200 OK
|<<guess_get_schema,`Guess`>>
|Specified guess returned.
|404 Not Found
|<<error_schema,`Error`>>
|No game exists with an `id` equal to the specified `gameId`, no guess identified by `guessId` exists, or guess identified by `guessId` is not associated with game identified by `gameId`.

|===

===== Example

====== Request

include::{snippets}/guesses/get-valid/http-request.adoc[]

====== Response

include::{snippets}/guesses/get-valid/http-response.adoc[]

==== Delete a game

===== Request

`DELETE /codebreaker/games/{gameId}`

Deletes the game (and all related guesses) with the unique identifier `gameId`.

====== Path parameters

include::{snippets}/games/get-valid/path-parameters.adoc[]

===== Responses

|===
|Status|Body|Description

|204 No Content
|_(none)_
|Specified game deleted.
|404 Not Found
|<<error_schema,`Error`>>
|No game exists with an `id` equal to the specified `gameId`.

|===

===== Example

====== Request

include::{snippets}/games/delete-valid/http-request.adoc[]

====== Response

include::{snippets}/games/delete-valid/http-response.adoc[]

== Schemas

[[game_schema]]
=== `Game`

[[game_post_schema]]
==== `POST` request body

include::{snippets}/games/post-valid/request-fields.adoc[]

[[game_get_schema]]
==== `GET` & `POST` response body

include::{snippets}/games/get-valid/response-fields.adoc[]

[[guess_schema]]
=== `Guess`

[[guess_post_schema]]
==== `POST` request body

include::{snippets}/guesses/post-valid/request-fields.adoc[]

[[guess_get_schema]]
==== `GET` & `POST` response body

include::{snippets}/guesses/get-valid/response-fields.adoc[]

[[error_schema]]
=== `Error`

include::{snippets}/games/post-invalid/response-fields.adoc[]

[[license_notices]]
== Copyrights and licenses

[discrete]
=== Codebreaker

(C) 2022 CNM Ingenuity, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

[discrete]
=== Spring Framework, Spring Boot, Spring Data, Spring HATEOAS, Spring REST Docs

(C) 2012-2021 the original author or authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

[discrete]
=== Hibernate ORM

(C) 2021 Red Hat Inc.

Licensed under the GNU Lesser General Public Library, version 2.1. You can find a copy of this license at https://www.gnu.org/licenses/lgpl-2.1.en.html
